language: android

jdk:
  - oraclejdk8

env:
    global:
        - NDK_VERSION=r12b
        - NDK_CCACHE=ccache
        - ANDROID_NDK_HOME=$HOME/.android/android-ndk-${NDK_VERSION}
        - SBTPATH=$HOME/.sbt
        - PATH=${ANDROID_NDK_HOME}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools:${PATH}

scala:
    - 2.11.8

before_cache:
    - find $HOME/.sbt -name "*.lock" | xargs rm
    - find $HOME/.ivy2 -name "*.lock" | xargs rm

cache:
    directories:
        - $HOME/.ivy2
        - $HOME/.sbt

android:
    components:
        - tools
        - build-tools-25.0.2
        - extra-android-m2repository

install:
    - >
      if [ ! -d "$ANDROID_NDK_HOME" ]; then
          mkdir -p $ANDROID_NDK_HOME;
          pushd $HOME/.android;
          export ARCH=`uname -m`;
          wget -q http://dl.google.com/android/repository/android-ndk-${NDK_VERSION}-linux-${ARCH}.zip;
          unzip -q android-ndk-${NDK_VERSION}-linux-${ARCH}.zip;
          popd;
      fi
    - >
      if [ ! -f "$SBTPATH/sbt" ]; then
          pushd $SBTPATH;
          wget -q https://raw.githubusercontent.com/paulp/sbt-extras/master/sbt;
          chmod a+x sbt;
          popd;
      fi

script:
    - $SBTPATH/sbt android:package

before_deploy:
      - git config --local user.name "xiuluo"
      - git config --local user.email "chen919695074@gmail.com"
      - git tag "$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)"

deploy:
  provider: releases
  api_key: "fhzcO+JDULdtEtAyKm5+qV7keiwKBXnJI2YG79ut8EFc30+klZxWa3HlUKqmgrKFIdmeDLtn3zRE9v9BKiUKxOyVna2Zz/jZhjxfILioCtj+KxGywA8LD9cSGsHpkvZ3Fr79K0Ze5Hue+s0aEtAIQqCYsULxk/113nIA+6UzoWoFC/KfHJBjDdz+skHfxcHDcOn/cBE6Z2h16r3m08RXAQYQP4oFDhDPkv5tzCWZpdaqcMK091Mh6520E3YJBQ6aQ1EbCi6t2kdWmq08Wn9MeshaWKq/jDH2WjZIFP1yaX6Gi0VG9M+Iv5QAeW4dLXf3ouXfvaod90LcN/JYEbQ8blKaeAc92U5e1YXkjnE/iZTIUP0/XR0dxr/xRBzM+Mv1AQAlL79PuKkdwMHYuv9xMAWqIE10EhabO9ykhSbMRXA5/0fYltRAr5d9S2kvHFFTUP9qqdiBdQvPjHcOjTEzx4Rz3REkRJp5eC1A+VKCT3tEDyrMS+/f5ZVJYn89LTiIIV433Nr1InYNQ+xELe34fhe715f9iTNlQnaQrj75dGWz/bsknUOXwEfWLI0g7f2TKBAu31WU6oAMCUdAjAY/KG5EgVJyV/gQXEgFP+o2217w3CuWp9YCrMaf+vfWaTP3TJ3hED8FEkJ8o7MArHd0UxTyyWCTpS4c+YS52FvEs3Q="
  file: "FILE TO UPLOAD"
  skip_cleanup: true
